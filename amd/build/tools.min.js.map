{"version":3,"file":"tools.min.js","sources":["../src/tools.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to load and render the tools for the AI assist plugin.\n *\n * @module     local_assist/tools\n * @copyright  2023 Matt Porritt <matt.porritt@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Display the mini toolbar. With the selected text.\n *\n * @param {Event} event The mouseup event.\n */\nconst handleSelection = (event) => {\n    const selectedText = window.getSelection().toString().trim();\n\n    if (selectedText.length > 0) {\n        // Remove existing toolbar if any\n        const existingToolbar = document.getElementById('mini-toolbar');\n        if (existingToolbar) {\n            existingToolbar.remove();\n        }\n\n        // Create mini toolbar\n        const toolbar = document.createElement('div');\n        toolbar.id = 'mini-toolbar';\n        toolbar.innerHTML = `<button onclick=\"doSomething()\">Action 1</button>\n                         <button onclick=\"doSomethingElse()\">Action 2</button>`;\n        toolbar.style.position = 'absolute';\n        toolbar.style.top = `${event.clientY}px`;\n        toolbar.style.left = `${event.clientX}px`;\n        toolbar.classList.add('btn-group'); // Bootstrap class\n\n        document.body.appendChild(toolbar);\n    }\n};\n\n/**\n * Add listener to Shadow DOM.\n *\n * @param {HTMLElement} root The root element of the Shadow DOM.\n */\nconst addListenerToShadowDOM = (root)=> {\n    root.addEventListener('mouseup', handleSelection);\n};\n\n/**\n * Add listener to iFrame.\n *\n * @param {HTMLIFrameElement} iframe The iFrame element.\n */\nconst addListenerToIframe = (iframe) => {\n    const iframeDocument = iframe.contentDocument || iframe.contentWindow.document;\n    iframeDocument.addEventListener('mouseup', handleSelection);\n};\n\n\n/**\n * Action 1.\n */\nconst doSomething = () => {\n    window.console.log('Action 1 triggered');\n};\n\n/**\n * Action 1.\n */\nconst doSomethingElse = () => {\n    window.console.log('Action 2 triggered');\n};\n\n\nexport const init = () => {\n    window.console.log('loaded');\n\n    // Add listener to  Shadow DOM.\n    const shadowElements = document.querySelectorAll('*');\n    shadowElements.forEach(el => {\n        if (el.shadowRoot) {\n            addListenerToShadowDOM(el.shadowRoot);\n        }\n    });\n\n    // Add listener to  iFrames.\n    const iframes = document.querySelectorAll('iframe');\n    iframes.forEach(addListenerToIframe);\n\n    // Add listener to  main document.\n    document.addEventListener('mouseup', handleSelection);\n};\n"],"names":["handleSelection","event","window","getSelection","toString","trim","length","existingToolbar","document","getElementById","remove","toolbar","createElement","id","innerHTML","style","position","top","clientY","left","clientX","classList","add","body","appendChild","addListenerToIframe","iframe","contentDocument","contentWindow","addEventListener","console","log","querySelectorAll","forEach","el","shadowRoot"],"mappings":";;;;;;;;MA4BMA,gBAAmBC,WACAC,OAAOC,eAAeC,WAAWC,OAErCC,OAAS,EAAG,OAEnBC,gBAAkBC,SAASC,eAAe,gBAC5CF,iBACAA,gBAAgBG,eAIdC,QAAUH,SAASI,cAAc,OACvCD,QAAQE,GAAK,eACbF,QAAQG,8IAERH,QAAQI,MAAMC,SAAW,WACzBL,QAAQI,MAAME,cAAShB,MAAMiB,cAC7BP,QAAQI,MAAMI,eAAUlB,MAAMmB,cAC9BT,QAAQU,UAAUC,IAAI,aAEtBd,SAASe,KAAKC,YAAYb,WAkB5Bc,oBAAuBC,UACFA,OAAOC,iBAAmBD,OAAOE,cAAcpB,UACvDqB,iBAAiB,UAAW7B,gCAmB3B,KAChBE,OAAO4B,QAAQC,IAAI,UAGIvB,SAASwB,iBAAiB,KAClCC,SAAQC,KACfA,GAAGC,YACoBD,GAAGC,WApC7BN,iBAAiB,UAAW7B,oBAyCjBQ,SAASwB,iBAAiB,UAClCC,QAAQR,qBAGhBjB,SAASqB,iBAAiB,UAAW7B"}