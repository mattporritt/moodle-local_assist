{"version":3,"file":"tools.min.js","sources":["../src/tools.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to load and render the tools for the AI assist plugin.\n *\n * @module     local_assist/tools\n * @copyright  2023 Matt Porritt <matt.porritt@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery'; // Jquery is required for Bootstrap 4 poppers.\nimport Templates from 'core/templates';\nimport * as coreStr from 'core/str';\n\nlet startX = 0; // Global variable to store the start X position of the mouse.\n\n/**\n * Display the mini toolbar. With the selected text.\n *\n * @param {Event} event The mouseup event.\n */\nconst handleSelection = async(event) => {\n    const selectedText = window.getSelection().toString().trim();\n    const endX = event.clientX; // X position at the end of selection.\n    window.console.log(selectedText);\n\n    if (selectedText.length > 0) {\n        // Remove existing toolbar if any.\n        $('#text-selection-popover').popover('hide').remove();\n\n        // Get popover content.\n        const popperContent = await Templates.render('local_assist/popover', {});\n\n        // Get popover title.\n        const popoverTitle = await coreStr.get_string('popover_title', 'local_assist');\n\n        // Calculate the position of the popover.\n        const x = startX < endX ? endX : startX; // Use the smaller X position.\n        const y = event.clientY;\n\n        // Create the popover using vanilla JavaScript.\n        const popover = document.createElement('div');\n        popover.id = 'text-selection-popover';\n        popover.style.position = 'absolute';\n        popover.style.top = `${y}px`;\n        popover.style.left = `${x}px`;\n        document.body.appendChild(popover);\n\n        // Initialize the popover using Bootstrap (which still uses jQuery).\n        $(popover).popover({\n            placement: 'right',\n            content: popperContent,\n            title: popoverTitle,\n            html: true,\n            trigger: 'manual',\n            offset: '15, 0' // Adjusts the popover position.\n        });\n\n        $(popover).popover('show');\n    } else {\n        $('#text-selection-popover').popover('hide').remove();\n    }\n};\n\n/**\n * Add listener to Shadow DOM.\n *\n * @param {HTMLElement} root The root element of the Shadow DOM.\n */\nconst addListenerToShadowDOM = (root)=> {\n    root.addEventListener('mouseup', handleSelection);\n};\n\n/**\n * Add listener to iFrame.\n *\n * @param {HTMLIFrameElement} iframe The iFrame element.\n */\nconst addListenerToIframe = (iframe) => {\n    const iframeDocument = iframe.contentDocument || iframe.contentWindow.document;\n    iframeDocument.addEventListener('mouseup', handleSelection);\n};\n\nexport const init = () => {\n    window.console.log('loaded');\n\n    // Add listener to  Shadow DOM.\n    const shadowElements = document.querySelectorAll('*');\n    shadowElements.forEach(el => {\n        if (el.shadowRoot) {\n            addListenerToShadowDOM(el.shadowRoot);\n        }\n    });\n\n    // Add listener to  iFrames.\n    const iframes = document.querySelectorAll('iframe');\n    iframes.forEach(addListenerToIframe);\n\n    // Add listener to  main document.\n    document.addEventListener('mouseup', handleSelection);\n\n    // Track the start of text selection.\n    document.addEventListener('mousedown', (event) => {\n        startX = event.clientX; // Update startX on mousedown.\n    });\n};\n"],"names":["startX","handleSelection","async","selectedText","window","getSelection","toString","trim","endX","event","clientX","console","log","length","popover","remove","popperContent","Templates","render","popoverTitle","coreStr","get_string","x","y","clientY","document","createElement","id","style","position","top","left","body","appendChild","placement","content","title","html","trigger","offset","addListenerToIframe","iframe","contentDocument","contentWindow","addEventListener","querySelectorAll","forEach","el","shadowRoot"],"mappings":";;;;;;;00BA2BIA,OAAS,QAOPC,gBAAkBC,MAAAA,cACdC,aAAeC,OAAOC,eAAeC,WAAWC,OAChDC,KAAOC,MAAMC,WACnBN,OAAOO,QAAQC,IAAIT,cAEfA,aAAaU,OAAS,EAAG,qBAEvB,2BAA2BC,QAAQ,QAAQC,eAGvCC,oBAAsBC,mBAAUC,OAAO,uBAAwB,IAG/DC,mBAAqBC,QAAQC,WAAW,gBAAiB,gBAGzDC,EAAItB,OAASQ,KAAOA,KAAOR,OAC3BuB,EAAId,MAAMe,QAGVV,QAAUW,SAASC,cAAc,OACvCZ,QAAQa,GAAK,yBACbb,QAAQc,MAAMC,SAAW,WACzBf,QAAQc,MAAME,cAASP,QACvBT,QAAQc,MAAMG,eAAUT,QACxBG,SAASO,KAAKC,YAAYnB,6BAGxBA,SAASA,QAAQ,CACfoB,UAAW,QACXC,QAASnB,cACToB,MAAOjB,aACPkB,MAAM,EACNC,QAAS,SACTC,OAAQ,8BAGVzB,SAASA,QAAQ,gCAEjB,2BAA2BA,QAAQ,QAAQC,UAkB/CyB,oBAAuBC,UACFA,OAAOC,iBAAmBD,OAAOE,cAAclB,UACvDmB,iBAAiB,UAAW3C,gCAG3B,KAChBG,OAAOO,QAAQC,IAAI,UAGIa,SAASoB,iBAAiB,KAClCC,SAAQC,KACfA,GAAGC,YACoBD,GAAGC,WApB7BJ,iBAAiB,UAAW3C,oBAyBjBwB,SAASoB,iBAAiB,UAClCC,QAAQN,qBAGhBf,SAASmB,iBAAiB,UAAW3C,iBAGrCwB,SAASmB,iBAAiB,aAAcnC,QACpCT,OAASS,MAAMC"}