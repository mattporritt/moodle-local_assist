{"version":3,"file":"tools.min.js","sources":["../src/tools.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to load and render the tools for the AI assist plugin.\n *\n * @module     local_assist/tools\n * @copyright  2023 Matt Porritt <matt.porritt@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\n//import Popper from 'core/popper';\n//import Templates from 'core/templates';\n\n/**\n * Display the mini toolbar. With the selected text.\n *\n * @param {Event} event The mouseup event.\n */\nconst handleSelection = async(event) => {\n    const selectedText = window.getSelection().toString().trim();\n    window.console.log(selectedText);\n\n    if (selectedText.length > 0) {\n        // Remove existing toolbar if any.\n        $('#text-selection-popover').popover('hide').remove();\n\n        // const x = event.clientX;\n        // const y = event.clientY;\n\n        // Create the popover using vanilla JavaScript\n        const popover = document.createElement('div');\n        popover.id = 'text-selection-popover';\n        popover.style.position = 'absolute';\n        popover.style.top = `${event.clientY}px`;\n        popover.style.left = `${event.clientX}px`;\n        document.body.appendChild(popover);\n\n        // Initialize the popover using Bootstrap (which still uses jQuery).\n        $(popover).popover({\n            placement: 'right',\n            content: 'Your popover content here',\n            title: 'Popover Title',\n            html: true,\n            trigger: 'manual'\n        });\n\n        $(popover).popover('show');\n    } else {\n        $('#text-selection-popover').popover('hide').remove();\n    }\n};\n\n/**\n * Add listener to Shadow DOM.\n *\n * @param {HTMLElement} root The root element of the Shadow DOM.\n */\nconst addListenerToShadowDOM = (root)=> {\n    root.addEventListener('mouseup', handleSelection);\n};\n\n/**\n * Add listener to iFrame.\n *\n * @param {HTMLIFrameElement} iframe The iFrame element.\n */\nconst addListenerToIframe = (iframe) => {\n    const iframeDocument = iframe.contentDocument || iframe.contentWindow.document;\n    iframeDocument.addEventListener('mouseup', handleSelection);\n};\n\nexport const init = () => {\n    window.console.log('loaded');\n\n    // Add listener to  Shadow DOM.\n    const shadowElements = document.querySelectorAll('*');\n    shadowElements.forEach(el => {\n        if (el.shadowRoot) {\n            addListenerToShadowDOM(el.shadowRoot);\n        }\n    });\n\n    // Add listener to  iFrames.\n    const iframes = document.querySelectorAll('iframe');\n    iframes.forEach(addListenerToIframe);\n\n    // Add listener to  main document.\n    document.addEventListener('mouseup', handleSelection);\n};\n"],"names":["handleSelection","async","selectedText","window","getSelection","toString","trim","console","log","length","popover","remove","document","createElement","id","style","position","top","event","clientY","left","clientX","body","appendChild","placement","content","title","html","trigger","addListenerToIframe","iframe","contentDocument","contentWindow","addEventListener","querySelectorAll","forEach","el","shadowRoot"],"mappings":";;;;;;;gJAgCMA,gBAAkBC,MAAAA,cACdC,aAAeC,OAAOC,eAAeC,WAAWC,UACtDH,OAAOI,QAAQC,IAAIN,cAEfA,aAAaO,OAAS,EAAG,qBAEvB,2BAA2BC,QAAQ,QAAQC,eAMvCD,QAAUE,SAASC,cAAc,OACvCH,QAAQI,GAAK,yBACbJ,QAAQK,MAAMC,SAAW,WACzBN,QAAQK,MAAME,cAASC,MAAMC,cAC7BT,QAAQK,MAAMK,eAAUF,MAAMG,cAC9BT,SAASU,KAAKC,YAAYb,6BAGxBA,SAASA,QAAQ,CACfc,UAAW,QACXC,QAAS,4BACTC,MAAO,gBACPC,MAAM,EACNC,QAAS,+BAGXlB,SAASA,QAAQ,gCAEjB,2BAA2BA,QAAQ,QAAQC,UAkB/CkB,oBAAuBC,UACFA,OAAOC,iBAAmBD,OAAOE,cAAcpB,UACvDqB,iBAAiB,UAAWjC,gCAG3B,KAChBG,OAAOI,QAAQC,IAAI,UAGII,SAASsB,iBAAiB,KAClCC,SAAQC,KACfA,GAAGC,YACoBD,GAAGC,WApB7BJ,iBAAiB,UAAWjC,oBAyBjBY,SAASsB,iBAAiB,UAClCC,QAAQN,qBAGhBjB,SAASqB,iBAAiB,UAAWjC"}