{"version":3,"file":"popover.min.js","sources":["../src/popover.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to load and render the tools for the AI assist plugin.\n *\n * @module     local_assist/popover\n * @copyright  2023 Matt Porritt <matt.porritt@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery'; // Jquery is required for Bootstrap 4 poppers.\nimport Templates from 'core/templates';\nimport * as coreStr from 'core/str';\n\n// Track if the popover is being interacted with.\nlet isPopoverInteraction = false;\n\n// Track the X position of the mouse at the start of the text selection.\nlet startX = 0;\n\n/**\n * Set the popover interaction state.\n *\n * @param {boolean} value The value to set.\n */\nexport const setIsPopoverInteraction = (value) => {\n    isPopoverInteraction = value;\n};\n\n/**\n * Get the popover interaction state.\n *\n * @returns {boolean} The popover interaction state.\n */\nexport const getIsPopoverInteraction = () => {\n    return isPopoverInteraction;\n};\n\n/**\n * Set the X position of the mouse at the start of the text selection.\n *\n * @param {boolean} value The value to set.\n */\nexport const setStartX = (value) => {\n    startX = value;\n};\n\n/**\n * Check if the popover contains the target element.\n *\n * @param {HTMLElement} target The target element.\n */\nexport const popoverContains = (target) => {\n    const popoverParent = document.getElementById('text-selection-popover');\n    if (popoverParent && popoverParent.nextElementSibling) {\n        const popoverElem = popoverParent.nextElementSibling;\n        return popoverElem && popoverElem.contains(target);\n    } else {\n        return false;\n    }\n};\n\n/**\n * Create the popover and load its content.\n *\n * @param {Event} event The mouseup event.\n * @param {string} parentId The ID of the element to be used as the parent of the popover.\n */\nexport const createPopover = async(event, parentId) => {\n    const popperContent = await Templates.render('local_assist/popover', {});\n    const popoverTitle = await coreStr.get_string('popover_title', 'local_assist');\n\n    const endX = event.clientX;\n    const x = startX < endX ? endX : startX;\n    const y = event.clientY;\n\n    const popover = document.createElement('div');\n    popover.id = parentId;\n    popover.style.position = 'absolute';\n    popover.style.top = `${y}px`;\n    popover.style.left = `${x}px`;\n    document.body.appendChild(popover);\n\n    $(popover).popover({\n        placement: 'right',\n        content: popperContent,\n        title: popoverTitle,\n        html: true,\n        trigger: 'manual',\n        offset: '15, 0'\n    });\n\n    return popover;\n};\n\n/**\n * Add event listeners to the popover.\n *\n * @param {function} clickHandler The function to call when a link is clicked.\n */\nexport const addPopoverListeners = (clickHandler) => {\n    document.querySelectorAll('.tool-assist-options a').forEach((link) => {\n        link.addEventListener('click', (event) => {\n            clickHandler(event, link.id); // Use the callback function\n        });\n    });\n};\n\n/**\n * Remove existing popover and its parent element.\n *\n * @param {string} parentId The ID of the element used as the parent of the popover.\n */\nexport const removePopover = (parentId) => {\n    $('#' + parentId).popover('hide').remove();\n};\n\n/**\n * Hide existing popover.\n *\n * @param {string} parentId The ID of the element used as the parent of the popover.\n */\nexport const hidePopover = (parentId) => {\n    $('#' + parentId).popover('hide');\n};\n\n/**\n * Show existing popover.\n *\n * @param {string} parentId The ID of the element used as the parent of the popover.\n */\nexport const showPopover = (parentId) => {\n    $('#' + parentId).popover('show');\n};\n\n/**\n * Checks if the popover is visible.\n *\n * @param {string} parentId The ID of the element used as the parent of the popover.\n * @returns {boolean} True if the popover is visible.\n */\nexport const isPopoverVisible = (parentId) => {\n    // Check if the popover element exists and is visible\n    const popover = $('#' + parentId).data('bs.popover');\n    return popover ? $(popover.getTipElement()).is(':visible') : false;\n};\n"],"names":["isPopoverInteraction","startX","value","target","popoverParent","document","getElementById","nextElementSibling","popoverElem","contains","async","event","parentId","popperContent","Templates","render","popoverTitle","coreStr","get_string","endX","clientX","x","y","clientY","popover","createElement","id","style","position","top","left","body","appendChild","placement","content","title","html","trigger","offset","clickHandler","querySelectorAll","forEach","link","addEventListener","remove","data","getTipElement","is"],"mappings":";;;;;;;yjCA4BIA,sBAAuB,EAGvBC,OAAS,mCAO2BC,QACpCF,qBAAuBE,wCAQY,IAC5BF,wCAQeE,QACtBD,OAASC,gCAQmBC,eACtBC,cAAgBC,SAASC,eAAe,6BAC1CF,eAAiBA,cAAcG,mBAAoB,OAC7CC,YAAcJ,cAAcG,0BAC3BC,aAAeA,YAAYC,SAASN,eAEpC,0BAUcO,MAAMC,MAAOC,kBAChCC,oBAAsBC,mBAAUC,OAAO,uBAAwB,IAC/DC,mBAAqBC,QAAQC,WAAW,gBAAiB,gBAEzDC,KAAOR,MAAMS,QACbC,EAAIpB,OAASkB,KAAOA,KAAOlB,OAC3BqB,EAAIX,MAAMY,QAEVC,QAAUnB,SAASoB,cAAc,cACvCD,QAAQE,GAAKd,SACbY,QAAQG,MAAMC,SAAW,WACzBJ,QAAQG,MAAME,cAASP,QACvBE,QAAQG,MAAMG,eAAUT,QACxBhB,SAAS0B,KAAKC,YAAYR,6BAExBA,SAASA,QAAQ,CACfS,UAAW,QACXC,QAASrB,cACTsB,MAAOnB,aACPoB,MAAM,EACNC,QAAS,SACTC,OAAQ,UAGLd,sCAQyBe,eAChClC,SAASmC,iBAAiB,0BAA0BC,SAASC,OACzDA,KAAKC,iBAAiB,SAAUhC,QAC5B4B,aAAa5B,MAAO+B,KAAKhB,kCAUPd,+BACxB,IAAMA,UAAUY,QAAQ,QAAQoB,+BAQVhC,+BACtB,IAAMA,UAAUY,QAAQ,8BAQFZ,+BACtB,IAAMA,UAAUY,QAAQ,mCASGZ,iBAEvBY,SAAU,mBAAE,IAAMZ,UAAUiC,KAAK,sBAChCrB,UAAU,mBAAEA,QAAQsB,iBAAiBC,GAAG"}